# Markdown Notebook
**Or: make the visitors do the work**

Markdown is super easy to use and is kind of the Official Language of the Internet now. HTML is old and busted. So when I decided that I was going to put up a collection of technical notebooks as a sort-of-blog, I had to do it in Markdown.

Unfortunately, all of the Markdown blogging systems I found in my 5 minutes of searching were these opinionated beasts.

## The Competition

**[Jekyll](https://jekyllrb.com/)** is a Ruby-based system that doesn't, officially, run on Windows. It integrates well with Github Pages, but that integration is through ["A simple Ruby Gem to bootstrap dependencies for setting up and maintaining a local Jekyll environment in sync with GitHub Pages"](https://github.com/github/pages-gem), which seems to want you to turn your blog *itself* into a Ruby gem. It also comes with a command-line tool.

I don't want to write a Ruby gem; I want to write a blog. I thought I could just decide to blog with Jekyll on Github Pages and upload my Jekyll-styled Markdown and have Github build the pages for me. Maybe you can, but I couldn't figure out how to do it. All the tutorials start out with "install some Ruby gems and run this command to make a file structure to put your blog in".

I've never been sold on the "command to stamp out a new project" paradigm. It might be easier when you're making your 27th new Node module or Jekyll blog or whatever, but when I make my first one it's important to me to understand each piece of the project structure and why it has to be there.

**[Octopress](http://octopress.org/)** has on its front page a big writeup about how it's really just Jekyll, and what's more is a massive git repo of Jekyll that you clone and add your own stuff to, with the expectation that you just rebase onto updates from upstream. It's an interesting idea, which might get me out of having to run a magic new blog creation command, but the writeup is all very discouraging about this whole way of doing things, and the new version isn't out yet. It doesn't sound like a software ship I want to sail in right now. Next!

**[Hexo](https://hexo.io/)** was examined long enough for me to read its tagline: "Hexo is a fast, simple & powerful blog framework powered by Node.js". In my experience, Node.js is indeed very powerful, but it's anything but simple. You need to make sure you have the right version of `node` itself. You need to make sure that `npm` has access to a working C/C++ compiler, because somewhere in the long chain of module dependencies that are required by the module you want, there may be native code. You need to make sure that that C/C++ compiler knows about node so it can find the headers. You need to [hope that all those dependencies are still there when you need them](https://www.reddit.com/r/programming/comments/4bjss2/an_11_line_npm_package_called_leftpad_with_only/).

[Here's the dependency graph for Hexo](http://npm.anvaka.com/#/view/2d/hexo). I got tired of watching it after it loaded a couple hundred nodes. Beautiful? Sure! Powerful? Probably! Simple? No.

So, I decided to put together my own solution.

## Challenger Approaching

What I decided I really wanted was something that would take a directory full of Markdown files and turn them into web pages without me having to do anything. Basically like Github: all you have to do is stick the files in, and the Markdown renderer renders them for you. Unfortunately, I thought hosting my blog directly *in* a Github project page would be a little bit silly, not to mention not very portable if I decided I wanted to put it on a real host. Plus, I had decided to use Github Pages for the actual hosting when I was looking at Jekyll, and was too stubborn to change when it looked like Jekyll wasn't going to work. Since Github Pages won't let you do anything server-side, that meant I would have to do all the rendering client-side.

I thought that a client-side Markdown-based website would be pretty hard to do, but then I remembered I had already seen it done before on [IPFS](https://ipfs.io). IPFS, the "Inter-Planetary File System", is a decentralized hash-based file retrieval system, with Web gateways that let you get at the content without having to run the client application. One of their examples is a [Markdown renderer](https://gateway.ipfs.io/ipfs/QmSrCRJmzE4zE1nAfWPbzVfanKQNBhp7ZWmMnEdbiLvYNh/mdown) that can let you store a directory full of Markdown files and turn it into a "permanent" hash-addressed web site. Since a file storage system can't do any Markdown rendering, the rendering all happens on the client. I decided that I could cannibalize that example renderer and turn it into a blog engine.

Getting it working to start with was surprisingly simple; I just grabbed the "mdown" file and all the "lib" stuff from [the Github](https://github.com/ipfs/examples/tree/master/webapps/markdown-viewer) and started replacing Markdown files with my own stuff. I had to work around the existence of a [???.jpg](https://github.com/ipfs/examples/blob/master/media/cs/%3F%3F%3F.jpg) file in the repo, which is an invalidf filename on Windows and prevented me from checking out the repo in  Github's desktop app. (The app seemed to have no clue what was going on; since I have been having trouble with filenames in Git not being valid on vrarious platforms all week, due to path component length or total length or the presence of special characters, that seemed like an error they really should have expected.) Eventually I just grabbed the .zip bundle for the repo and pulled out the files I needed.

However, once I had it working, there were a number of things I had to change. The original had the renderer page named just `mdown`, but Github Pages would serve it as a download instead of a web page. I had to add a `.html` extension, and ended up naming it `index.html` so I would have a proper front page.

After that, I looked at how the renderer decided what Markdown file to render. It would just keep the Markdown file in the "hash" portion of the URL, so `http://website.biz/index.html#blogpost.md` would be the URL for `blogpost.md`. I diodn't think that was very Google-able, so I swapped over to using hashbangs: `http://website.biz/index.html#!blogpost.md`.

I always like having the ability to link to headings, so I added some (as yet untested) code to take a URL like `http://website.biz/index.html#!blogpost.md#anchor` and scroll to the appropriate heading. It doesn't actually use `<a>` tags, but I think it will be adequate for deep links.

I then decided that I wanted my links in Markdown files to look more normal. I don't want to say `[link](#!page.md)` to link to another page or `[link](!#thispage.md#heading)` to link to a heading in the current document. That's nonstandard. I want normal-looking links like `[link](page.md)` and `[link](#heading)`. So I added link rewriting to take the rendered markdown and fix up all the links to Markdown files to invoke the renderer instead of going directly to the unformatted file.

Finally, I did a pass over the site layout. The original IPFS renderer was kind of hacked-together; it would take the Markdown filename, load it with jQuery, stick it inside a tag on the page, and invoke [Strapdown](http://strapdownjs.com/). Strapdiown was designed to take a page with some markdown in an HTML tag and build the rest of the page around it, so in addition to rendering the actual Markdown with [marked](https://github.com/chjj/marked), Strapdown would turn around and add a bunch of Bootstrap stylesheets and (if it couldn't find one) its own generated navbar to the page. But Strapdown was using what I think was Bootstrap 2, and I had grabbed a theme for Bootstrap 3 that I wanted to use. In Bootstrap 3, the theme basically replaces the Bootstrap stylesheet itself, there's no `bootstrap-min.css`, and I think it handles the navbar differently. Moreover, Strapdown didn't seem to include the JavaScript for Bootstrap, which I needed in order to get the nice expandy mobile navbar menu, which is sort of the reason to use Bootstrap in the first place.

I went through a few iterations, but eventually what I did was to rip out the old Bootstrap and all of Strapdown except the part where it actually renders and re-styles the Markdown. I put all the stylesheet links and the navbar in manually, and added in my preferred theme of Bootstrap 3, the Bootstrap 3 JavaScript, and a new build of jQuery to make it work. Throw in a nice custom navbar and a bit of logic, and everything is much cleaner. No need to add extra stylesheets dynamically, no need to paste unformatted Markdown text into a hidden DOM element, and no extra unused theme files for themes I'm not using.

The result, which I'm tentatively calling "Markdown Notebook", is [here on Github](https://github.com/interfect/interfect.github.io), where it comes with my entire blog. It's definitely easy to author posts, but I think I want to add some kind of automated front page functionality, to generate links to recent posts for me. It would be nice if I could get it to work from `file:` URLs in a local browser, but apparently letting JavaScript on disk read files on disk is [not allowed anymore](https://stackoverflow.com/questions/29371600/chrome-browser-security-implications-of-allow-file-access-from-files) by default.
